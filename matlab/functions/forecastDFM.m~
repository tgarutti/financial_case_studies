function [ forecasts, MAE, RMSE ] = forecastDFM( Y, X, favar, var, w, k ,...
    SR, shortRate)
%FORECASTDFM Forecasts a dynamic factor model specified by favar and var
%for a given window and forecast horizon.
%   The dynamic factor model is given by
%   (1)    Y(t) = A*Y(t-1) + B*X(t),
%   (2)    X(t) = C*X(t-1),
%   where the relation (1) is specified by favar and (2) by var. The
%   objects favar and var need to be inputted as varm objects
%   This is forecasted over a moving window of length w for forecast 
%   horizons of 1-k.
%   SR is a boolean specifying if the short rate should be estimated by
%   means of the Bernanke equation using the forecasts of Y. 
%% Initialization of variables
if SR == TRUE
    c = size(X,2)+1;
else
    c = size(X,2);
end
n = length(Y(:,1)); 
u = n-w+1;

forecasts = zeros(u, c, k);

%% Estimate Forecasts
for i = 1:u
    window = i:(i+w-1);
    
    Yw = Y(window,:);
    Xw = X(window,:);
    
    [XFit,~,~,~] = estimate(var, Xw);
    [Xforecasts,~] = forecast(XFit, k, Xw);
    
    [YFit,~,~,~] = estimate(favar, Yw, 'X', Xw);
    [Yforecasts,~] = forecast(YFit, k, Yw, 'X', Xforecasts);
    
    for j = 1:k
        if SR == TRUE
        forecasts(i,2:end,j) = f(j,:);
        forecasts(i,1,j) = 0.02 + 1.0*forecasts(i,4,j) + ...
            1.5*forecasts(i,3,j) - 0.5*0.02;
        else
            
    end
end
end

